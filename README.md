# MinionAWS

Ater cloning run install.py to install needed python packages it is assumed that the user already has python and pip. Then the AWS cli must be configured, since this is different on different operating systems refer to the AWS documentation for how to install [aws cli](https://aws.amazon.com/cli/). MD_gui needs to be next to the minionaws folder, if you want to move the program you can make a shortcut and put that wherever you want. 


The program has 4 main functions, Transfer, Compile, Archive, and Unarchive. After the minion transmits its data to the satilite iridium sends the message to our SQS server, this is where new messages will be. The Transfer function in MD_gui.py polls this SQS server and saves the messages to our S3 Storage. Once a message is read from SQS it is deleted. On S3 you will see that the messages get sorted into folders marked by the IMEI of the device, this is done by Transfer as it saves the messages to S3. The actually name of the messages is given by the SQS message ID that was assigned by AWS. Looking at folders on S3 will show that there are two sates a device can have 'Archived' or active. The Compile button downloads all the active IMEIs, which is any folder that does not begin 'Archive', The first thing it does is create a folder 'sbd_' in the working directory, then it downloads all sbd data into this folder. Once that step is complete, we create a new folder called 'csv' and loop through each file in 'sbd_' saving the data to a corrosponding csv file. Each IMEI gets its own csv, so in the csv folder you should see once csv for each active IMEI. The csv contains more than just the sbd payload since it also has metadata sent by iridium. The next step in the function if to go through each csv file, create a txt file for each active IMEI, then loop through the CSV (as a pandas dataframe) and paste the sbd payload into the txt file. This process generates one txt file which contains all data the minion has transmitted thus far; this text file has not had the data processed in any way, all that has been done at this point is copying and pasting / concating the sbd data, so if there is every an issue with unix time for example, you can look at the main text file for each active device and see the raw data sent by the minion. Then the final steps invole looking through the main txt files and creating individual file types, putting in unix time and sample count data is added in this step and KML files are generated. This completes the complie and in the end you should see a 'sbd_' folder, 'csv' folder, and a folder for each active device. The last to functions Archive and Unarchive allow you to controll which imeis are currently active. Since the data is split up to be transmitted, a problem faced with automation is how to know whether or not a given message is and update of old mission to be appended or a brand new mission. For a given IMEI there can only be once active mission at a time, otherwise new data will be appended to old files. Hence once a mission is complete the user must archive it so that the program wont append to that folder anymore and imei can be used in a new mission. This is accomplished by clicking 'Archive' and giving the misson a name. The rules for allowed names are the same as those for AWS s3 folders, [rules](https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-keys.html). If for what ever reson you need to be able to re activiate an old mission (this should not ever be needed, unless someone archives a mission before it is done) then you simply use the unarchive function, which will aske for the IMEI of the device and the name the mission whas given. Note that if you unachive an old mission whose IMEI is currently active the data from the two missions will be merged into one file. 
